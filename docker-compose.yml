version: "3"
services:
  web:
    image: "node:${NODE_VERSION}"
    user: "node"
    working_dir: /home/node/web
    environment:
      - NODE_ENV="${NODE_ENV}"
    volumes:
      - ./web:/home/node/web
    depends_on:
      - "api"
    ports:
      - "${PORT_WEB}:3000"
    command: bash -c "yarn && yarn start"

  api:
    image: "node:${NODE_VERSION}"
    user: "node"
    environment:
      - NODE_ENV="${NODE_ENV}"
    working_dir: /home/node/api
    volumes:
      - ./api:/home/node/api
    depends_on:
      - "rethinkdb"
    links:
      - "rethinkdb:rethinkdb"
    ports:
      - "${PORT_API}:4000"
    command: bash -c "yarn && yarn start"

  auth:
    image: "node:${NODE_VERSION}"
    user: "node"
    environment:
      - NODE_ENV="${NODE_ENV}"
    working_dir: /home/node/auth
    volumes:
      - ./auth:/home/node/auth
    ports:
      - "${PORT_AUTH}:4100"
    command: bash -c "yarn && yarn start"

  rethinkdb:
    image: "rethinkdb"
    ports:
      - "${PORT_RETHINKDB}:28015"

  portainer:
    image: portainer/portainer
    command: -H unix:///var/run/docker.sock --no-auth
    ports:
      - "${PORT_PORTAINER}:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer:/data

volumes:
  portainer:
